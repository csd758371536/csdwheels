!function(e,a){"function"==typeof define&&define.amd?define([],a):"object"==typeof module&&module.exports?module.exports=a():e.Calendar=a()}("undefined"!=typeof self?self:this,function(){"use strict";var t="calendar-input",n="calendar-wrapper",i="calendar-btn-prev",d="calendar-btn-next",l="calendar-btn",o="calendar-day",c={addEvent:function(e,a,t){e.addEventListener?e.addEventListener(a,t,!1):e.attachEvent?e.attachEvent("on"+a,t):e["on"+a]=t},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},extend:function(e){for(var a=1,t=arguments.length;a<t;a++)for(var n in arguments[a])arguments[a].hasOwnProperty(n)&&(e[n]=arguments[a][n]);return e},isValidListener:function(e){return"function"==typeof e||!(!e||"object"!=typeof e)&&c.isValidListener(e.listener)},indexOf:function(e,a){if(e.indexOf)return e.indexOf(a);for(var t=-1,n=0,r=e.length;n<r;n++)if(e[n]===a){t=n;break}return t},isLastDate:function(e,a){return e===new Date(this.calendarMax).getFullYear()&&a===new Date(this.calendarMax).getMonth()+1},getFirstDateInMonth:function(e){return new Date(e.getFullYear(),e.getMonth(),1)},getLastDateInPrevMonth:function(e){return new Date(e.getFullYear(),e.getMonth(),0)},getLastDateInMonth:function(e){return new Date(e.getFullYear(),e.getMonth()+1,0)},daysInMonth:function(e,a){var t=new Date;return t.setFullYear(e,12==a?1:a,0),t.getDate()},formatDate:function(e,a){function t(e){return((e="string"==typeof e?parseInt(e):e)<10?"0":"")+e}var n=t((e="string"==typeof e?new Date(e):e).getFullYear()),r=t(e.getMonth()+1),s=t(e.getDate()),i=t(e.getDay());return{getFullYear:parseInt(n),getMonth:parseInt(r),getDate:parseInt(s),getDay:parseInt(i),date:a.replace(/yyyy|MM|dd/g,function(e){switch(e){case"yyyy":return n;case"MM":return r;case"dd":return s}})}}};function e(){this.__events={}}function a(e,a){this.options=c.extend({},this.constructor.calendarOptions,a,!0),this._initCalendar(e),this.calendarTime=c.formatDate(this.options.time,"yyyy-MM-dd").date,this.calendarShowTime=c.formatDate(this.options.time,"yyyy-MM").date,this._refreshCalendar(new Date(this.options.time)),this._getCalendar(),this._bindCalendar()}e.prototype.on=function(e,a){if(e&&a){if(!c.isValidListener(a))throw new TypeError("listener must be a function");var t=this.__events,n=t[e]=t[e]||[],r="object"==typeof a;return-1===c.indexOf(n,a)&&n.push(r?a:{listener:a,once:!1}),this}},e.prototype.once=function(e,a){return this.on(e,{listener:a,once:!0})},e.prototype.off=function(e,a){var t=this.__events[e];if(t){for(var n,r=0,s=t.length;r<s;r++)if(t[r]&&t[r].listener===a){n=r;break}return void 0!==n&&t.splice(n,1,null),this}},e.prototype.emit=function(e,a){var t=this.__events[e];if(t){for(var n=0;n<t.length;n++){var r=t[n];r&&(r.listener.apply(this,a||[]),r.once&&this.off(e,r.listener))}return this}},a.calendarOptions={};var r=a.prototype=new e;return r.constructor=a,r._initCalendar=function(e){this.calendar=document.querySelector(e),this.calendar.onselectstart=function(){return!1},this.calendarWeeks=["Su","Mo","Tu","We","Th","Fr","Sa"],this.calendarMaxDay=31,this.calendarMax=c.formatDate(new Date(864e13),"yyyy-MM-dd").date,this.calendarMin="100-01-01",this.calendarRow=Math.floor(this.calendarMaxDay/this.calendarWeeks.length)+2,this.calendarDaysCount=this.calendarWeeks.length*this.calendarRow},r._refreshCalendar=function(e){this._setCalendarDays(e),this._renderCalendar()},r._getCalendar=function(){},r._setCalendarDays=function(e){this.calendarDays=[],this._setCalendarDaysInPrevMonth(e),this._setCalendarDaysInCurrentMonth(e),this._setCalendarDaysInNextMonth(e)},r._setCalendarDaysInPrevMonth=function(e){var a=c.getFirstDateInMonth(e).getDay(),t=c.getLastDateInPrevMonth(e).getDate(),n=0===a?t-this.calendarWeeks.length+1:t-a+1;this._setCalendarDaysInMonth(e.getMonth()<1?e.getFullYear()-1:e.getFullYear(),e.getMonth()<1?12:e.getMonth(),n,t,!1)},r._setCalendarDaysInCurrentMonth=function(e){var a;a=c.isLastDate(e.getFullYear(),e.getMonth()+1)?new Date(this.calendarMax).getDate():c.getLastDateInMonth(e).getDate(),this._setCalendarDaysInMonth(e.getFullYear(),e.getMonth()+1,1,a,!0)},r._setCalendarDaysInNextMonth=function(e){c.isLastDate(e.getFullYear(),e.getMonth()+1)||this.calendarDays.length!=this.calendarDaysCount&&this._setCalendarDaysInMonth(12<e.getMonth()+2?e.getFullYear()+1:e.getFullYear(),12<e.getMonth()+2?1:e.getMonth()+2,1,this.calendarDaysCount-this.calendarDays.length,!1)},r._setCalendarDaysInMonth=function(e,a,t,n,r){for(var s=t,i=n;s<=i;s++)this.calendarDays.push({year:e,month:a,day:s,isCurrent:r})},r._renderCalendar=function(){var e=document.querySelector("."+t);e||(e='<input type="text" class="calendar-input" readonly placeholder="点击选择日期" />',this.calendar.innerHTML=e);var a=document.querySelector("."+n);a||(a=document.createElement("div"),this.calendar.appendChild(a),a.className=n),a.innerHTML='{{calendarShowTime}}<table class="calendar-content">{{calendarWeeks}}{{calendarDays}}</table>'.replace("{{calendarShowTime}}",this._renderCalendarTitle()).replace("{{calendarWeeks}}",this._renderCalendarWeeks()).replace("{{calendarDays}}",this._renderCalendarDays())},r._renderCalendarTitle=function(){return'<div class="calendar-title"><a href="javascript:;" class="calendar-btn calendar-btn-prev" id="calendarDatePrev">&lt;</a><span class="calendar-time" id="calendarDateTime">'+this.calendarShowTime+'</span><a href="javascript:;" class="calendar-btn calendar-btn-next" id="calendarDateNext">&gt;</a></div>'},r._renderCalendarWeeks=function(){for(var e="",a=0;a<this.calendarWeeks.length;a++)e+='<th class="calendar-week">'+this.calendarWeeks[a]+"</th>";return'<thead><tr class="calendar-weeks">'+e+"</tr></thead>"},r._renderCalendarDays=function(){for(var e="",a=[],t=[],n=this.calendarWeeks.length,r=0;r<this.calendarRow;r++){e="",e+='<tr class="calendar-days">',t=this.calendarDays.slice(r*n,r*n+n);for(var s=0;s<t.length;s++)t[s].isCurrent?c.formatDate(new Date(t[s].year,t[s].month-1,t[s].day),"yyyy-MM-dd").date===this.calendarTime?e+='<td class="calendar-day select" data-date="'+t[s].day+'">'+t[s].day+"</td>":e+='<td class="calendar-day current" data-date="'+t[s].day+'">'+t[s].day+"</td>":e+='<td class="calendar-day" data-date="'+t[s].day+'">'+t[s].day+"</td>";e+="</tr>",a.push(e)}return a.join("")},r._bindCalendar=function(){this._bindCalendarInput(),this._bindCalendarContent(),this._bindCalendarBtn()},r._bindCalendarInput=function(){var s=this,i=document.querySelector("."+t),d=document.querySelector("."+n);this.calendarIsOpen=!1,c.addEvent(i,"click",function(e){var a=e||window.event;a.target||a.srcElement;if(s.calendarIsOpen)d.classList.remove("calendar-wrapper-show"),s.calendarIsOpen=!1;else{d.classList.add("calendar-wrapper-show");var t=s.calendar.offsetLeft,n=s.calendar.offsetTop,r=i.offsetHeight;d.style.top=n+r+2+"px",d.style.left=t+"px",s.calendarIsOpen=!0}})},r._bindCalendarContent=function(){var s=this,i=document.querySelector("."+t),d=document.querySelector("."+n);c.addEvent(d,"click",function(e){var a=e||window.event,t=a.target||a.srcElement,n=document.querySelectorAll("."+o);if("td"===t.tagName.toLowerCase()){for(var r=0;r<n.length;r++)if(n[r]===t){s.calendarTime=c.formatDate(new Date(s.calendarDays[r].year,s.calendarDays[r].month-1,s.calendarDays[r].day),"yyyy-MM-dd").date,s.calendarShowTime=c.formatDate(new Date(s.calendarDays[r].year,s.calendarDays[r].month-1,s.calendarDays[r].day),"yyyy-MM").date,s._refreshCalendar(new Date(s.calendarTime));break}s.emit("click",[s.calendarTime]),i.value=s.calendarTime,d.classList.remove("calendar-wrapper-show"),s.calendarIsOpen=!1}})},r._bindCalendarBtn=function(){var s=this,e=document.querySelector("."+n);c.addEvent(e,"click",function(e){var a=e||window.event,t=a.target||a.srcElement,n=new Date(s.calendarShowTime).getFullYear(),r=new Date(s.calendarShowTime).getMonth()+1;t.classList.contains(l)&&(t.classList.contains(i)?s._bindCalendarPrev(n,r):t.classList.contains(d)&&s._bindCalendarNext(n,r))})},r._bindCalendarPrev=function(e,a){--a<1&&(a=12,e--),this.calendarShowTime=c.formatDate(new Date(e,a-1,new Date(this.calendarTime).getDate()),"yyyy-MM").date,this._refreshCalendar(new Date(this.calendarShowTime))},r._bindCalendarNext=function(e,a){c.isLastDate(e,a)||(12<++a&&(a=1,e++),this.calendarShowTime=c.formatDate(new Date(e,a-1,new Date(this.calendarTime).getDate()),"yyyy-MM").date,this._refreshCalendar(new Date(this.calendarShowTime)))},a});